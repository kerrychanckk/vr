<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬ä¸€èº«è™›æ“¬å°è¦½</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è¦†è“‹å±¤æ¨£å¼ - ç”¨æ–¼é¡¯ç¤ºè³‡è¨Šå¡ç‰‡ */
        #info-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 999;
            display: none;
            pointer-events: auto;
        }
        
        /* UI æŒ‰éˆ•æ¨£å¼ */
        .ui-layer {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 100;
        }

        /* è‡ªå®šç¾©æ»‘é¼ æ¨£å¼ï¼Œè®“ç”¨æˆ¶çŸ¥é“å¯ä»¥æ‹–æ›³ */
        a-scene {
            cursor: grab;
        }
        a-scene:active {
            cursor: grabbing;
        }
    </style>
</head>
<body>

    <!-- UI å±¤ï¼šæ§åˆ¶æŒ‰éˆ• -->
    <div class="ui-layer space-y-2">
        <a href="index.html" class="block bg-white/90 hover:bg-white text-gray-800 px-4 py-2 rounded-lg font-bold shadow-lg transition">
            ğŸ”™ è¿”å›ä¸»é 
        </a>
        <div class="bg-black/50 text-white px-4 py-2 rounded-lg text-sm backdrop-blur-sm">
            <p>ğŸ–±ï¸ æ‹–æ›³ç•«é¢è§€çœ‹å››å‘¨</p>
            <p>ğŸ”´ é»æ“Šç´…é»æŸ¥çœ‹è³‡è¨Š</p>
            <p>ğŸ”µ é»æ“Šè—é»åˆ‡æ›å ´æ™¯</p>
        </div>
    </div>

    <!-- è³‡è¨Šå½ˆå‡ºå¡ç‰‡ -->
    <div id="info-overlay" class="w-full max-w-sm">
        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden transform transition-all scale-100 border-2 border-indigo-100">
            <div class="bg-indigo-600 p-4 flex justify-between items-center">
                <h3 id="info-title" class="text-white font-bold text-lg">æ¨™é¡Œ</h3>
                <button onclick="closeInfo()" class="text-white hover:bg-indigo-500 rounded-full p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <p id="info-desc" class="text-gray-600 leading-relaxed mb-4">é€™è£¡æ˜¯è©³ç´°ä»‹ç´¹...</p>
                <img id="info-img" src="" class="w-full h-40 object-cover rounded-lg hidden" alt="Detail">
            </div>
        </div>
    </div>

    <!-- A-Frame 3D å ´æ™¯ -->
    <!-- raycaster="objects: .clickable" ç¢ºä¿åªæœ‰å¸¶æœ‰ clickable class çš„ç‰©ä»¶èƒ½è¢«é»æ“Š -->
    <a-scene cursor="rayOrigin: mouse" raycaster="objects: .clickable" loading-screen="dotsColor: white; backgroundColor: #1e1e2e">
        
        <!-- è³‡æºé åŠ è¼‰ -->
        <a-assets>
            <!-- é€™è£¡ä½¿ç”¨ä½”ä½åœ–ç‰‡ï¼Œå¯¦éš›ä½¿ç”¨æ™‚è«‹æ›æˆä½ çš„ 360 ç…§ç‰‡ -->
            <img id="sky-lobby" src="vr.jpg" crossorigin="anonymous">
            <img id="sky-garden" src="vr.jpg" crossorigin="anonymous">
        </a-assets>

        <!-- 360 å…¨æ™¯èƒŒæ™¯çƒé«” -->
        <a-sky id="main-sky" src="#sky-lobby" rotation="0 -130 0" animation__fade="property: material.opacity; from: 0; to: 1; dur: 1500; startEvents: fadein"></a-sky>

        <!-- æ”åƒæ©Ÿ (ç”¨æˆ¶è¦–è§’) -->
        <a-entity camera look-controls="reverseMouseDrag: true" position="0 1.6 0"></a-entity>

        <!-- å ´æ™¯å®¹å™¨ï¼šæˆ‘å€‘æœƒç”¨ JS å‹•æ…‹ç”Ÿæˆè£¡é¢çš„ç†±é» -->
        <a-entity id="scene-container"></a-entity>

    </a-scene>

    <script>
        // --- å°è¦½æ•¸æ“š ---
        const tourData = {
            "lobby": {
                bg: "#sky-lobby",
                rotation: "0 -130 0",
                hotspots: [
                    {
                        type: "info",
                        position: "-4 1 -5",
                        color: "#ef4444", // Red
                        title: "ğŸ« å­¸æ ¡å¤§å ‚",
                        desc: "é€™æ˜¯æˆ‘å€‘å­¸æ ¡çš„ä¸»å…¥å£ï¼Œå»ºæ–¼ 1985 å¹´ã€‚å¤§å ‚æ­£ä¸­å¤®çš„æ ¡å¾½è±¡å¾µè‘—æˆ‘å€‘è¦åƒç…å­ä¸€æ¨£å‹‡æ•¢ã€‚",
                        image: "https://placehold.co/600x400/orange/white?text=Lobby+Photo"
                    },
                    {
                        type: "info",
                        position: "5 2 -3",
                        color: "#ef4444",
                        title: "ğŸ† çç›ƒæ«ƒ",
                        desc: "é€™è£¡å±•ç¤ºäº†æˆ‘å€‘å­¸æ ¡åœ¨å„é …æ ¡éš›æ¯”è³½ä¸­ç²å¾—çš„æ¦®è­½ï¼ŒåŒ…æ‹¬å»å¹´çš„å…¨æ¸¯æœ—èª¦å† è»ï¼"
                    },
                    {
                        type: "scene",
                        position: "8 1 2", 
                        color: "#3b82f6", // Blue
                        target: "garden",
                        title: "å‰å¾€ï¼šç”Ÿæ…‹èŠ±åœ’ ğŸŒ¿",
                        desc: "é»æ“Šå‚³é€åˆ°æˆ¶å¤–èŠ±åœ’ã€‚"
                    }
                ]
            },
            "garden": {
                bg: "#sky-garden",
                rotation: "0 45 0",
                hotspots: [
                    {
                        type: "info",
                        position: "-2 1 -3",
                        color: "#ef4444",
                        title: "ğŸ¢ çƒé¾œæ± ",
                        desc: "é€™è£¡ä½è‘—ä¸‰éš»çƒé¾œï¼šå¤§å¯¶ã€äºŒå¯¶å’Œå°å¯¶ã€‚è«‹ä¸è¦é¤µé£Ÿç‰ å€‘å–”ï¼"
                    },
                    {
                        type: "scene",
                        position: "-5 1 4",
                        color: "#3b82f6",
                        target: "lobby",
                        title: "è¿”å›ï¼šå­¸æ ¡å¤§å ‚ ğŸ«",
                        desc: "é»æ“Šè¿”å›å®¤å…§ã€‚"
                    }
                ]
            }
        };

        // --- ç‹€æ…‹è®Šæ•¸ ---
        let currentSceneId = 'lobby';

        // --- åˆå§‹åŒ– ---
        window.onload = function() {
            loadScene('lobby');
        };

        // --- è¼‰å…¥å ´æ™¯å‡½æ•¸ ---
        function loadScene(sceneId) {
            const data = tourData[sceneId];
            const sky = document.querySelector('#main-sky');
            const container = document.querySelector('#scene-container');

            // 1. æ·¡å‡ºæ•ˆæœ (ç°¡å–®æ¨¡æ“¬ï¼šå…ˆè®Šé»‘å†è®Šåœ–)
            // åœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œæˆ‘å€‘é€šå¸¸æœƒåšä¸€å€‹é»‘è‰²çƒé«”æ·¡å…¥æ·¡å‡º
            
            // 2. æ›åœ–
            sky.setAttribute('src', data.bg);
            if(data.rotation) sky.setAttribute('rotation', data.rotation);

            // 3. æ¸…ç©ºèˆŠç†±é»
            container.innerHTML = '';

            // 4. ç”Ÿæˆæ–°ç†±é»
            data.hotspots.forEach(spot => {
                const entity = document.createElement('a-entity');
                
                // è¨­å®šå¤–è§€ (çƒé«” + å‹•ç•«)
                entity.setAttribute('geometry', 'primitive: sphere; radius: 0.3');
                entity.setAttribute('material', `color: ${spot.color}; opacity: 0.9; shader: flat`);
                entity.setAttribute('position', spot.position);
                
                // åŠ å…¥ "clickable" class è®“ raycaster åµæ¸¬åˆ°
                entity.setAttribute('class', 'clickable');

                // åŠ å…¥æ‡¸æµ®å‹•ç•« (ä¸Šä¸‹æµ®å‹•)
                entity.setAttribute('animation', 'property: position; to: ' + adjustY(spot.position, 0.2) + '; dir: alternate; dur: 2000; loop: true');
                
                // åŠ å…¥æ”¾å¤§å‹•ç•« (æ»‘é¼ æ‡¸åœæ™‚)
                entity.setAttribute('animation__scale', 'property: scale; to: 1.2 1.2 1.2; dur: 200; startEvents: mouseenter');
                entity.setAttribute('animation__scale_back', 'property: scale; to: 1 1 1; dur: 200; startEvents: mouseleave');

                // é»æ“Šäº‹ä»¶
                entity.addEventListener('click', () => {
                    if (spot.type === 'info') {
                        showInfo(spot.title, spot.desc, spot.image);
                    } else if (spot.type === 'scene') {
                        loadScene(spot.target);
                    }
                });

                // å¢åŠ ä¸€å€‹æ–‡å­—æ¨™ç±¤åœ¨ç†±é»ä¸Šæ–¹
                const text = document.createElement('a-text');
                text.setAttribute('value', spot.title);
                text.setAttribute('align', 'center');
                text.setAttribute('position', '0 0.5 0');
                text.setAttribute('scale', '1.5 1.5 1.5');
                text.setAttribute('side', 'double'); // é›™é¢å¯è¦‹
                // è®“æ–‡å­—æ°¸é é¢å‘æ”åƒæ©Ÿ (billboardæ•ˆæœ - ç°¡åŒ–ç‰ˆ)
                text.setAttribute('look-at', '[camera]'); 
                
                entity.appendChild(text);
                container.appendChild(entity);
            });
        }

        // --- è¼”åŠ©å‡½æ•¸ï¼šèª¿æ•´ Y è»¸åº§æ¨™ ---
        function adjustY(posStr, amount) {
            const parts = posStr.split(' ').map(Number);
            return `${parts[0]} ${parts[1] + amount} ${parts[2]}`;
        }

        // --- UI é‚è¼¯ ---
        function showInfo(title, desc, imgSrc) {
            const overlay = document.getElementById('info-overlay');
            const t = document.getElementById('info-title');
            const d = document.getElementById('info-desc');
            const img = document.getElementById('info-img');

            t.textContent = title;
            d.textContent = desc;
            
            if (imgSrc) {
                img.src = imgSrc;
                img.classList.remove('hidden');
            } else {
                img.classList.add('hidden');
            }

            overlay.style.display = 'block';
        }

        function closeInfo() {
            document.getElementById('info-overlay').style.display = 'none';
        }
    </script>
</body>
</html>
